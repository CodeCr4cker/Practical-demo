<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Coder's Journey</title>
  <style>
    * { box-sizing: border-box; }

    .page-content {
      opacity: 0;
      transform: translateY(-20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .page-content.animate-in {
      opacity: 1;
      transform: translateY(0);
    }

    body {
      margin: 0;
      display: flex;
      min-height: 100dvh;
      perspective: 1000px;
      font-size: 1rem;
      overflow: hidden;
      color: hsl(180 68% 5%);
      background-image: radial-gradient(circle farthest-corner at 50% 50%, hsl(189, 56%, 73%) 30%, hsl(150, 80%, 75%) 100%);
    }

    .book {
      position: relative;
      display: flex;
      margin: auto;
      width: 40cqmin;
      height: 550px;
      pointer-events: auto;
      transform-style: preserve-3d;
      transition: translate 1s;
      translate: calc(min(var(--c), 1) * 50%) 0%;
      rotate: 1 0 0 30deg;
      counter-reset: page -1;
    }

    .neon-typing {
      color: var(--neon-yellow);
      text-shadow: var(--neon-shadow-yellow);
      line-height: 1.4;
    }

    .page {
      --thickness: 4;
      flex: none;
      display: flex;
      width: 100%;
      font-size: 1.5cqmin;
      pointer-events: all;
      user-select: none;
      transform-style: preserve-3d;
      transform-origin: left center;
      transition:
        transform 1s,
        rotate 1s ease-in calc((min(var(--i), var(--c)) - max(var(--i), var(--c))) * 50ms);
      translate: calc(var(--i) * -100%) 0px 0px;
      transform: translateZ( calc((var(--c) - var(--i) - 0.5) * calc(var(--thickness) * .23cqmin)));
      rotate: 0 1 0 calc(clamp(0, var(--c) - var(--i), 1) * -180deg);
      box-shadow: 0em .5em 1em -.2em #00000020;
    }

    .front,
    .back {
      position: relative;
      flex: none;
      width: 100%;
      backface-visibility: hidden;
      overflow: hidden;
      background-color: #fff;
      display: flex;
      flex-flow: column wrap;
      justify-content: flex-start;
      padding: 2em;
      border: 1px solid #0002;
    }

    .front::after,
    .back::after {
      position: absolute;
      bottom: 1em;
      counter-increment: page;
      content: counter(page) ".";
      font-size: 0.8em;
    }

    .front::after { right: 1em; }
    .back {
      translate: -100% 0;
      rotate: 0 1 0 180deg;
    }
    .back::after { left: 1em; }

    .cover {
      background: radial-gradient(circle farthest-corner at 80% 20%, hsl(150 80% 20% / .3) 0%, hsl(170 60% 10% / .1) 100%),
      hsl(231, 32%, 29%) url("https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=600&fit=crop") 50% / cover;
      color: hsl(200 30% 98%);
      pointer-events: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .cover::after { content: ""; }

    .cover-title {
      font-size: 2em;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      margin: 0;
    }

    .cover-subtitle {
      font-size: 1.2em;
      margin-top: 0.5em;
      font-style: italic;
      opacity: 0.9;
    }

    h1 {
      font-size: 1.8em;
      margin: 0.5em 0;
      text-align: center;
    }

    h2 {
      font-size: 1.3em;
      margin: 0.4em 0;
      text-align: center;
    }

    p {
      font-size: 0.95em;
      margin: 0.4em 0;
    }

    /* 3D Rotating Image Styles */
    .page-image-container {
      position: absolute;
      top: 1em;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 120px;
      perspective: 500px;
      z-index: 10;
    }

    .page-image {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      opacity: 0;
      transform: scale(0) rotateY(0deg);
      transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      transform-style: preserve-3d;
      object-fit: cover;
    }

    .page-image.show {
      opacity: 1;
      transform: scale(1) rotateY(0deg);
      animation: rotate3D 4s linear infinite;
    }

    .page-image.hide {
      opacity: 0;
      transform: scale(0) rotateY(180deg);
    }

    @keyframes rotate3D {
      0% { transform: scale(1) rotateY(0deg) rotateX(0deg); }
      25% { transform: scale(1) rotateY(90deg) rotateX(5deg); }
      50% { transform: scale(1) rotateY(180deg) rotateX(0deg); }
      75% { transform: scale(1) rotateY(270deg) rotateX(-5deg); }
      100% { transform: scale(1) rotateY(360deg) rotateX(0deg); }
    }

    /* Content spacing to accommodate top image */
    .page-content {
      padding-top: 140px;
    }

    .page-content h2:first-child {
      margin-top: 0;
    }

    /* Audio control styles */
    .audio-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .audio-controls button {
      background: #007bff;
      color: white;
      border: none;
      padding: 5px 10px;
      margin: 0 5px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .audio-controls button:hover {
      background: #0056b3;
    }

    .audio-controls button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    @media (max-width: 768px) {
      body {
        font-size: 0.9rem;
      }

      .page {
        font-size: 1.2cqmin;
      }

      h1 {
        font-size: 1.5em;
      }

      h2 {
        font-size: 1.1em;
      }

      p {
        font-size: 0.85em;
      }
      
      .book {
        height: 200px;
      }

      .page-image-container {
        width: 80px;
        height: 80px;
      }

      .page-content {
        padding-top: 100px;
      }

      .audio-controls {
        top: 10px;
        right: 10px;
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="audio-controls">
    <button id="muteBtn">🔊</button>
    <button id="speedBtn">1x</button>
  </div>

  <div class="book">
    <div class="page">
      <div class="front cover">
        <div>
          <h1 class="cover-title">The Digital Dreamer</h1>
          <p class="cover-subtitle">A Journey Through Code and Creativity</p>
        </div>
      </div>
      <div class="back"></div>
    </div>

    <div class="page">
      <div class="front">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face" alt="Young dreamer" class="page-image" id="img1">
        </div>
        <div class="page-content">
          <h2>Chapter 1: The Spark Ignites</h2>
          <p><span id="type1" class="neon-typing"></span></p>
        </div>
      </div>
      <div class="back">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=150&h=150&fit=crop" alt="First computer" class="page-image" id="img2">
        </div>
        <div class="page-content">
          <h2>Chapter 2: The First Discovery</h2>
          <p><span id="type2" class="neon-typing"></span></p>
        </div>
      </div>
    </div>

    <div class="page">
      <div class="front">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=150&h=150&fit=crop" alt="Learning to code" class="page-image" id="img3">
        </div>
        <div class="page-content">
          <h2>Chapter 3: The Learning Begins</h2>
          <p><span id="type3" class="neon-typing"></span></p>
        </div>
      </div>
      <div class="back">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1517077304055-6e89abbf09b0?w=150&h=150&fit=crop" alt="Skills growing" class="page-image" id="img4">
        </div>
        <div class="page-content">
          <h2>Chapter 4: The Skills Awaken</h2>
          <p><span id="type4" class="neon-typing"></span></p>
        </div>
      </div>
    </div>

    <div class="page">
      <div class="front">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=150&h=150&fit=crop" alt="Future vision" class="page-image" id="img5">
        </div>
        <div class="page-content">
          <h2>Chapter 5: The Vision Forms</h2>
          <p><span id="type5" class="neon-typing"></span></p>
        </div>
      </div>
      <div class="back">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=150&h=150&fit=crop" alt="Collaboration" class="page-image" id="img6">
        </div>
        <div class="page-content">
          <h2>Chapter 6: The Network Expands</h2>
          <p><span id="type6" class="neon-typing"></span></p>
        </div>
      </div>
    </div>

    <div class="page">
      <div class="front">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=150&h=150&fit=crop" alt="Continuous learning" class="page-image" id="img7">
        </div>
        <div class="page-content">
          <h2>Chapter 7: The Wisdom Grows</h2>
          <p><span id="type7" class="neon-typing"></span></p>
        </div>
      </div>
      <div class="back">
        <div class="page-image-container">
          <img src="https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=150&h=150&fit=crop" alt="Success celebration" class="page-image" id="img8">
        </div>
        <div class="page-content">
          <h2>Chapter 8: The Journey Continues</h2>
          <p><span id="type8" class="neon-typing"></span></p>
        </div>
      </div>
    </div>

    <div class="page">
      <div class="front"></div>
      <div class="back cover">
        <div style="text-align: center; color: white;">
          <h2>The End... Or Is It?</h2>
          <p>Every ending is a new beginning.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let globalClicked = false;
    let audioEnabled = true;
    let speechRate = 0.9;
    let currentUtterance = null;
    let isTyping = false;

    document.addEventListener("DOMContentLoaded", () => {
      const elBook = document.querySelector(".book");
      flipBook(elBook);
      initAudioControls();
    });

    function initAudioControls() {
      const muteBtn = document.getElementById('muteBtn');
      const speedBtn = document.getElementById('speedBtn');

      muteBtn.addEventListener('click', () => {
        audioEnabled = !audioEnabled;
        muteBtn.textContent = audioEnabled ? '🔊' : '🔇';
        if (!audioEnabled && currentUtterance) {
          speechSynthesis.cancel();
        }
      });

      speedBtn.addEventListener('click', () => {
        if (speechRate === 0.9) {
          speechRate = 1.0;
          speedBtn.textContent = '1x';
        } else if (speechRate === 1.0) {
          speechRate = 1.2;
          speedBtn.textContent = '1.2x';
        } else {
          speechRate = 0.9;
          speedBtn.textContent = '0.9x';
        }
      });
    }

    function flipBook(elBook) {
      elBook.style.setProperty("--c", 0);
      const pages = elBook.querySelectorAll(".page");
      pages.forEach((page, idx) => page.style.setProperty("--i", idx));

      const coverPage = pages[0];
      coverPage.addEventListener("click", () => {
        if (globalClicked) return;
        globalClicked = true;
        elBook.style.setProperty("--c", 1);
        setTimeout(() => startTypingSequence(elBook), 1000);
      });

      window.resetBook = () => {
        globalClicked = false;
        isTyping = false;
        elBook.style.setProperty("--c", 0);
        speechSynthesis.cancel();
        currentUtterance = null;
        document.querySelectorAll('.neon-typing').forEach(el => el.innerHTML = '');
        document.querySelectorAll('.page-content').forEach(content => content.classList.remove('animate-in'));
        document.querySelectorAll('.page-image').forEach(img => {
          img.classList.remove('show', 'hide');
        });
        console.log("Book reset completed");
      };
    }

    const typingPages = [
      {
        front: "#type1",
        back: "#type2",
        frontText: "यह वेबसाइट दिव्यांशु पांडे द्वारा बनाई गई है जिन्होंने HTML CSS और JS का उपयोग किया है .",
        backText: "That first program was simple—just a few lines that made the computer say 'Hello, World!' But to Alex, it was like witnessing the birth of a star. The computer had listened, understood, and responded. It was the beginning of a conversation that would change everything. From that moment, Alex knew that coding wasn't just about writing instructions—it was about bringing imagination to life, one line at a time.",
        frontImage: "#img1",
        backImage: "#img2"
      },
      {
        front: "#type3",
        back: "#type4",
        frontText: "Days turned into weeks, and weeks into months. Alex spent countless hours in front of the screen, learning the language of machines. HTML became poetry, CSS became art, and JavaScript became magic. Each new concept was like discovering a new color in an artist's palette. The more Alex learned, the more beautiful the digital canvas became.",
        backText: "Soon, Alex's skills began to bloom like flowers in spring. HTML laid the foundation like strong roots, CSS painted the world in vibrant colors, and JavaScript breathed life into static pages. Firebase became the bridge between dreams and reality, allowing creations to live and breathe in the cloud. Each project was a stepping stone across the river of knowledge, leading to greater adventures ahead.",
        frontImage: "#img3",
        backImage: "#img4"
      },
      {
        front: "#type5",
        back: "#type6",
        frontText: "One quiet evening, as Alex gazed at the code glowing on the screen, a vision formed in the mind's eye. It wasn't just about building websites or apps—it was about creating solutions that could touch lives, solve problems, and make the world a little bit better. The dream expanded beyond personal success to encompass cybersecurity, artificial intelligence, and ethical hacking—tools to protect and empower others.",
        backText: "But Alex knew that the greatest adventures are shared ones. The coding community became a second family—developers from around the world who spoke the same language of logic and creativity. Through forums, open-source projects, and collaborative efforts, Alex discovered that the most beautiful code is written not in isolation, but in harmony with others who share the same passion for building the future.",
        frontImage: "#img5",
        backImage: "#img6"
      },
      {
        front: "#type7",
        back: "#type8",
        frontText: "Through trial and error, success and failure, Alex learned the most important lesson of all: the journey of learning never ends. Each bug was a puzzle to solve, each error message a teacher in disguise. The philosophy became clear—embrace the unknown, dive into challenges headfirst, and never stop asking 'What if?' because the greatest discoveries come from the courage to explore uncharted territories.",
        backText: "And so, dear reader, as you reach the end of this chapter, remember that every expert was once a beginner, every master was once a student, and every great achievement started with a single step. Alex's story continues to unfold, filled with new challenges, discoveries, and dreams yet to be realized. The keyboard awaits, the screen glows with potential, and the next adventure is just a click away. Thank you for joining this journey—may your own story be filled with code, creativity, and endless possibilities.",
        frontImage: "#img7",
        backImage: "#img8"
      }
    ];

    function showImage(imageId) {
      const img = document.querySelector(imageId);
      if (img) {
        img.classList.add('show');
        img.classList.remove('hide');
      }
    }

    function hideImage(imageId) {
      const img = document.querySelector(imageId);
      if (img) {
        img.classList.add('hide');
        img.classList.remove('show');
      }
    }

    function hideAllImages() {
      document.querySelectorAll('.page-image').forEach(img => {
        img.classList.add('hide');
        img.classList.remove('show');
      });
    }

    // Enhanced Text-to-Speech with simultaneous typing
    function speakText(text, onWordSpoken) {
      if (!audioEnabled || !('speechSynthesis' in window)) return Promise.resolve();

      return new Promise((resolve) => {
        speechSynthesis.cancel();
        
        // Clean the text for better pronunciation
        const cleanText = text
          .replace(/[^\w\s.,!?;:'-]/g, ' ')
          .replace(/\s+/g, ' ')
          .trim();

        if (cleanText.length === 0) {
          resolve();
          return;
        }

        const utterance = new SpeechSynthesisUtterance(cleanText);
        utterance.lang = 'en-US';
        utterance.rate = speechRate;
        utterance.pitch = 1.1;
        utterance.volume = 0.8;
        
        let wordIndex = 0;
        const words = cleanText.split(' ');
        
        // Create a more natural word-by-word synchronization
        utterance.onboundary = (event) => {
          if (event.name === 'word' && wordIndex < words.length && onWordSpoken) {
            onWordSpoken(wordIndex);
            wordIndex++;
          }
        };
        
        utterance.onend = () => {
          currentUtterance = null;
          resolve();
        };
        
        utterance.onerror = (error) => {
          console.log('Speech error:', error);
          currentUtterance = null;
          resolve();
        };

        currentUtterance = utterance;
        speechSynthesis.speak(utterance);
      });
    }

    // Enhanced typing with speech synchronization
    async function typeTextWithSpeech(el, text, callback) {
      if (!audioEnabled) {
        // If audio is disabled, just type normally
        return typeText(el, text, callback);
      }

      isTyping = true;
      el.innerHTML = "";
      
      const words = text.split(' ');
      let currentWordIndex = 0;
      let currentCharIndex = 0;
      
      // Start speech
      const speechPromise = speakText(text, (spokenWordIndex) => {
        // Sync typing with speech
        if (spokenWordIndex < words.length && isTyping) {
          const targetIndex = words.slice(0, spokenWordIndex + 1).join(' ').length;
          while (currentCharIndex < targetIndex && currentCharIndex < text.length && isTyping) {
            setTimeout(() => {
              if (isTyping && currentCharIndex < text.length) {
                el.innerHTML = text.substring(0, currentCharIndex + 1);
                currentCharIndex++;
              }
            }, 20);
          }
        }
      });

      // Fallback typing in case speech events don't fire
      const typingInterval = setInterval(() => {
        if (!isTyping || currentCharIndex >= text.length) {
          clearInterval(typingInterval);
          return;
        }
        
        if (currentCharIndex < text.length) {
          el.innerHTML = text.substring(0, currentCharIndex + 1);
          currentCharIndex++;
        }
      }, 50);

      // Wait for speech to complete
      await speechPromise;
      clearInterval(typingInterval);
      
      // Ensure all text is displayed
      if (isTyping)
